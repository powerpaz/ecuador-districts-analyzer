<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard ‚Äî Distritos Educativos (EC)</title>

<!-- Leaflet + MarkerCluster -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" crossorigin="anonymous">
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="anonymous"></script>
<script defer src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin="anonymous"></script>

<!-- PapaParse (CSV) -->
<script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<!-- TopoJSON (para provincias .json Topology) -->
<script defer src="https://unpkg.com/topojson-client@3"></script>

<!-- Supabase UMD -->
<script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

<style>
  :root{
    --bg:#0B1426; --card:#1F2937; --muted:#9CA3AF; --b:#374151; --acc:#3B82F6;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,sans-serif;background:#0B1426;color:#F9FAFB}
  .wrap{max-width:1400px;margin:0 auto;padding:18px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:18px}
  .panel{background:var(--card);border:1px solid var(--b);border-radius:14px;padding:16px}
  .row{margin-bottom:14px}
  input,select,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--b);background:#111827;color:#F9FAFB}
  button{cursor:pointer;background:var(--acc);border:none}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:8px 12px;border:1px solid var(--b);border-radius:999px;background:#111827;color:#D1D5DB;cursor:pointer}
  .chip.active{background:#2563eb;border-color:#2563eb;color:#fff}
  #map{height:72vh;border-radius:14px;border:1px solid var(--b)}
  .stats{display:flex;gap:10px;flex-wrap:wrap;color:#D1D5DB}
  .stat{background:#111827;border:1px solid var(--b);border-radius:10px;padding:10px 12px}
  .stat b{color:#fff}
  #counter{margin-top:8px;color:#D1D5DB}
  /* Autocomplete */
  #suggest div{border-bottom:1px solid #284a91}
  /* Loading */
  #loading{position:fixed;inset:0;background:rgba(11,20,38,.96);display:flex;align-items:center;justify-content:center;z-index:9999}
  #loading .box{text-align:center}
  #loading .spin{width:44px;height:44px;border:3px solid #30384a;border-top:3px solid #3B82F6;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 12px}
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div id="loading"><div class="box"><div class="spin"></div><div>Cargando sistema‚Ä¶</div></div></div>

<div class="wrap">
  <h1 style="margin:0 0 10px 0">Sistema Geoespacial ‚Äî Distritos Educativos (EC)</h1>

  <div class="grid">
    <aside class="panel">
      <div class="row">
        <label>üîé B√∫squeda</label>
        <div style="position:relative">
          <input id="q" type="search" placeholder="C√≥digo, nombre, provincia‚Ä¶">
          <div id="suggest" style="display:none;position:absolute;left:0;right:0;top:44px;background:#0a1c3b;border:1px solid #284a91;border-radius:8px;max-height:260px;overflow:auto;z-index:1000"></div>
        </div>
      </div>

      <div class="row">
        <label>üìç Provincia</label>
        <select id="provSel"><option value="">Todas</option></select>
      </div>
      <div class="row">
        <label>üèõÔ∏è Cant√≥n</label>
        <select id="cantonSel"><option value="">Todos</option></select>
      </div>

      <div class="row">
        <label>üè∑Ô∏è Categor√≠as</label>
        <div id="chips" class="chips"></div>
      </div>

      <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <button id="btnAll" type="button">Limpiar filtros</button>
        <button id="btnProv" type="button" style="background:#0ea5e9">Provincias: ON</button>
        <button id="btnExport" type="button" style="grid-column:1 / -1;background:#10b981">Exportar CSV</button>
      </div>

      <div class="stats">
        <div class="stat">Total: <b id="nTotal">‚Äî</b></div>
        <div class="stat">Visibles: <b id="nFilt">‚Äî</b></div>
      </div>
      <div id="counter"></div>
    </aside>

    <main class="panel">
      <div id="map"></div>
      <div id="details" class="panel" style="margin-top:14px"></div>
    </main>
  </div>
</div>

<!-- Tu l√≥gica principal -->
<script defer src="app.js"></script>

<!-- NO-OPS opcionales para evitar errores si el JS las llama -->
<script>
  window.showDistritoDetails = function (campos) {
    const d = document.getElementById('details');
    d.innerHTML = `
      <div><b>${campos.COD_DISTRI||''}</b> ‚Äî ${campos.NOM_DISTRI||''}</div>
      <div style="opacity:.8">Provincia: ${campos.DPA_DESPRO||''} ‚Ä¢ Cant√≥n: ${campos.DPA_DESCAN||''}</div>`;
  };
  window.updateDashboard = function(){/* coloca KPIs/Chart.js si luego quieres */};
</script>

</body>
</html>
